
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	Если VAExtensionКлиент.ЭтоWindowsКлиент() Тогда
		

		//Проверяем есть ли модуль БСП
		Попытка
			МодульБСПМенеджерОборудованияКлиент = VAExtensionКлиент.ОбщийМодуль("МенеджерОборудованияКлиент")
		Исключение
		    МодульБСПМенеджерОборудованияКлиент = Неопределено;
		КонецПопытки;   
		
		Если МодульБСПМенеджерОборудованияКлиент <> Неопределено Тогда
			
			// Найдем первый подключенный сканер на текущем рабочем месте
			Источник = "";
			СписокПодключенногоОборудования = МодульБСПМенеджерОборудованияКлиент.ПолучитьПодключенныеУстройства("СканерШтрихкода");
			Если СписокПодключенногоОборудования.Количество() Тогда
				Источник = СписокПодключенногоОборудования[0].ИДУстройства;
			КонецЕсли;
			
			// Получаем данные через буфер обмена - безопасный режим расширения VAExtension должен быть отключен.
			COMОбъектHtmlfile = Новый COMОбъект("htmlfile");
    		Штрихкод = COMОбъектHtmlfile.ParentWindow.ClipboardData.Getdata("Text");    
			
			// Вызываем СобытиеОтУстройства аналогично тому как это делает "ОбработкаВнешнегоСобытия" модуля приложения
			ОписаниеОшибки  = "";
			ОписаниеСобытия = Новый Структура();  
			ОписаниеСобытия.Вставить("Источник", Источник);
			ОписаниеСобытия.Вставить("Событие",  "Штрихкод");
			ОписаниеСобытия.Вставить("Данные",   Штрихкод);  
			

			Результат = МодульБСПМенеджерОборудованияКлиент.ОбработатьСобытиеОтУстройства(ОписаниеСобытия, ОписаниеОшибки);    
			
			Если Не Результат Тогда
				VAExtensionКлиент.СообщитьПользователю(НСтр("ru='При обработке внешнего события от устройства произошла ошибка.'") + Символы.ПС + ОписаниеОшибки);
			КонецЕсли;
			
		КонецЕсли;	
	КонецЕсли;	
	
КонецПроцедуры

